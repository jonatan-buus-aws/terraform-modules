# Elastic Kubernetes Service (EKS)
The Elastic Kubernetes Service (EKS) module will create a new EKS cluster running under the provided IAM role and spanning the specified subnets.
Please see the following links for details:
- [Amazon EKS Kubernetes versions](https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html "AWS documentation")
- [Application load balancing on Amazon EKS](https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html "AWS documentation")
- [Create an IAM OIDC provider for your cluster](https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html "AWS documentation")
- [Amazon EKS clusters](https://docs.aws.amazon.com/eks/latest/userguide/clusters.html "AWS documentation")
- [Cluster VPC considerations](https://docs.aws.amazon.com/eks/latest/userguide/network_reqs.html "AWS documentation")
- [Amazon EKS cluster endpoint access control](https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html "AWS documentation")
- [Amazon EKS troubleshooting](https://docs.aws.amazon.com/eks/latest/userguide/troubleshooting.html "AWS documentation")
- [How can I get my worker nodes to join my Amazon EKS cluster?](https://aws.amazon.com/premiumsupport/knowledge-center/eks-worker-nodes-cluster/ "AWS documentation")
- [eks_cluster](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster "Terraform documentation")
- [aws_eks_node_group](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_node_group "Terraform documentation")

## Input
| Name | Description | Type  | Default | Required |
| ---- | ----------- |:-----:|:-------:|:--------:|
| eks\_cluster\_name | The name of the EKS cluster that will be created | `String` | `none` | Yes |
| eks\_cluster\_role | The name of the IAM role that will be used for the created EKS cluster | `String` | `none` | Yes |
| eks\_cluster\_subnets | List of subnets that the created EKS cluster will span. The subnets should be in at least 2 availability zones. | `List` | `none` | Yes |
| eks\_service\_account | The name of the IAM role that will be used for the service account in the created EKS cluster | `String` | `none` | Yes |
| eks\_node\_role | The name of the IAM role that will be used for the worker nodes created for the EKS cluster | `String` | `none` | Yes |
| eks\_node\_config | The general configuration of the worker nodes created for the EKS cluster, see below for details. | `Object` | `default` | No |
| eks\_on\_demand\_scaling\_config | The scaling configuration of the node group for `on-demand` worker nodes created for the EKS cluster, see below for details | `Object` | `default` | No |
| eks\_spot\_scaling\_config | The scaling configuration of the node group for `spot` worker nodes created for the EKS cluster, see below for details | `Object` | `default` | No |
| eks\_cluster\_version | The Kubernetes master version for the created EKS cluster. | `Number` | `1.20` | No |
| eks\_security\_groups | List of IDs for the security groups that nodes in the created EKS cluster will be part of in addition to the default security group created by EKS. | `List` | `empty list` | No |
| eks\_cluster\_logs | List of logs generated by the created EKS cluster. Defaults to all available EKS logs: api, audit, authenticator, controllerManager and scheduler | `List` | `api`, `audit`, `authenticator`, `controllerManager`, `scheduler` | No |
| eks\_cluster\_cidr | The CIDR block that the created EKS cluster will assign Kubernetes service IP addresses from | `String` | `10.100.0.0/16` | No |
| eks\_secure\_cluster | Flag indicating whether the the default security group created by EKS should be secured in accordance with best practices | `Boolean` | `true` | No |
| eks\_node\_ssh\_key | EC2 Key Pair name that provides access for SSH communication with the worker nodes in the EKS Node Group. If you specify this configuration, but do not specify `eks_node_ssh_security_groups` when you create an EKS Node Group, port 22 on the worker nodes is opened to the Internet (0.0.0.0/0). Please note that it is generally recommended NOT to allow remote login to the worker nodes but accessing a worker node may be useful for debugging. | `String` | `empty string` | No |
| eks\_node\_ssh\_security\_groups | List of EC2 Security Group IDs to allow SSH access (port 22) from on the worker nodes. Default to an empty list which will open SSH access to the worker nodes to the Internet (0.0.0.0/0) | `List` | `empty list` | No |

### eks\_node\_config
| Name | Description | Type  | Default | Required |
| ---- | ----------- |:-----:|:-------:|:--------:|
| ami_type | Type of Amazon Machine Image (AMI) associated with the 2 node groups created for the EKS cluster | `String` | `AL2_x86_64` | No |
| instance_type | Instance type for the worker nodes created for the EKS cluster. | `String` | `t3.medium` | No |
| disk_size | Disk size in `GiB` for the worker nodes created for the EKS cluster. | `Number` | `20` | No |
| labels | Key-value map of Kubernetes labels that will be applied to the worker nodes created for the EKS cluster | `Map` | `empty map` | No |
| launch_template_name | The name of the EC2 Launch Template that will be used to create the worker nodes for the EKS cluster | `String` | `empty string` | No |
| launch_template_version | The version number of the EC2 Launch Template that will be used to create the worker nodes for the EKS cluster. Using the `default_version` or `latest_version attribute` of the [aws_launch_template](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_template "Terraform documentation") resource or data source is recommended for this argument. | `String` | `empty string` | No |
| subnets | List of IDs for the subnets that the EC2 nodes for the created EKS cluster will span. Defaults to the specified subnets for the EKS cluster. | `List` | `empty list` | No |

### eks\_on\_demand\_scaling\_config and eks\_on\_spot\_scaling\_config
The `eks\_on\_demand\_scaling\_config` and `eks\_on\_spot\_scaling\_config` input parameters have the same properties as detailed by the table below.
| Name | Description | Type  | Default | Required |
| ---- | ----------- |:-----:|:-------:|:--------:|
| name | The of the node group created for the EKS cluster. Defaults to a sensible name reflecting the EKS cluster and node group type (on-demand or spot) if set to an empty string | `String` | `empty string` | No |
| min\_size | The minimum number of worker nodes that will be available in the node group created for the EKS cluster. Set to `-1` to create 1 worker node in each availability zone or `0` to prevent creation of any worker nodes in the node group. | `Number` | `-1` | No |
| max\_size | The maximum number of worker nodes that may be launched in the node group created for the EKS cluster. Set to `-1` to create a maximum of 1 worker node in each availability zone for the `on-demand` group and a maximum of 2 worker nodes in each availability zone for the `spot` group thereby ensuring that scaling happens via `spot instances`. Set to `0` to prevent creation of any worker nodes in the node group. | `Number` | `-1` | No |
| desired\_size | The desired number of worker nodes in the node group created for the EKS cluster. Set to `-1` to create 1 worker node in each availability zone or `0` to prevent creation of any worker nodes in the node group. | `Number` | `-1` | Yes |

## Output
| Name | Description | Type  |
| ------------- | ------------- |:-----:|
| eks\_cluster\_id | The id of the created EKS cluster | `String` |
| eks\_cluster\arn | The Amazon Resource Name (ARN) of the created EKS Cluster. Will be of format: `arn:aws:eks:::[EKS CLUSTER ID]` | `String` |
| eks\_cluster\_endpoint | The end-point for the created EKS cluster's Kubernetes API server| `String` |
| eks\_standard\_policies | The list of generated standard IAM policies for an EKS cluster:  `eks_cluster` `ec2_node_group` or `fargate` in JSON format. These policies may be passed as input to the `IAM Role` module through the `iam_assume_role_policy` input variable or in the `policy` field of an entry in the `iam_policies` list by referencing: `module.iam_role.iam_standard_policies.[POLICY_NAME]` | `Map` |
